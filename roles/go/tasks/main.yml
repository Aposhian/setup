---
- name: Download go
  get_url:
    checksum: sha256:{{ go_checksum }}
    dest: /tmp/go.tar.gz
    url: https://go.dev/dl/go{{ go_version }}.linux-{{ deb_architecture }}.tar.gz
- name: Extract go
  become: yes
  unarchive:
    creates: "{{ go_dir }}"
    remote_src: yes
    src: /tmp/go.tar.gz
    dest: "{{ go_dir | dirname }}"
- name: Add go to PATH
  lineinfile:
    path: "{{ shell_env }}"
    create: yes
    line: export PATH="$PATH:{{ (go_dir, 'bin') | path_join }}"
  when: shell_env is defined
- name: Get GOPATH
  command:
    cmd: "{{ (go_dir, 'bin', 'go') | path_join }} env GOPATH"
  register: gopath_result
- name: Set go_path fact
  set_fact:
    go_path: gopath_result.stdout
- name: Add GOPATH bin to user path
  lineinfile:
    path: "{{ shell_env }}"
    create: yes
    line: export PATH="$PATH:{{ (go_path, 'bin') | path_join }}"
  when: shell_env is defined
